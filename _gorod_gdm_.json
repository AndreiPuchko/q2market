{
 "modules": [
  {
   "name": "_gorod_gdm__after_data_loaded",
   "script": "?form.r.gd_id",
   "comment": "",
   "last_line": "1",
   "q2_time": "20240625224728",
   "q2_mode": "u"
  },
  {
   "name": "_gorod_gdm__autorun",
   "script": "ensure_empty_pk(\"students\", {\"first_name\":\"-\"})\r\nensure_empty_pk(\"subjects\")",
   "comment": "",
   "last_line": "2",
   "q2_time": "20240625122142",
   "q2_mode": "u"
  },
  {
   "name": "_gorod_gdm__row_extender",
   "script": "def row_extender(data, id):\r\n    if \"X\" in data:\r\n        for index,x in enumerate(data[\"X\"].replace(\" \", \"\")):\r\n            data[f\"{index+1}X\"] = x\r\n    if \"Y\" in data:\r\n        for index,x in enumerate(data[\"Y\"].replace(\" \", \"\")):\r\n            data[f\"{index+1}Y\"] = x\r\n\r\n    prices = {row[\"code\"]: \"\u2610\" for row in q2cursor(\"select * from subjects_prices\").records()}\r\n\r\n    for x in prices.keys():\r\n        for y in data.keys():\r\n            if f\"#{x}#\" in data[y]:\r\n                prices[x] = \"\u2611\ufe0f\"\r\n    price_whr = \", \".join([f'\"{key}\"' for key in prices.keys() if prices[key] == \"\u2611\ufe0f\" ])\r\n    \r\n    total = q2cursor(f\"\"\"\r\n                        select \r\n                            sum(case when price1<>0 and (\r\n                                select max(\"*\")\r\n                                from  subjects_prices, subjects\r\n                                where subjects_prices.parent_id = subjects.id and\r\n                                    code in ({price_whr }) and discount1= \"*\"\r\n                                ) =\"*\" then price1 else price end) as total\r\n\r\n                        from  subjects_prices, subjects\r\n                        where subjects_prices.parent_id = subjects.id and\r\n                            code in  ({price_whr })     \r\n\r\n                                \"\"\").r.total\r\n    data[\"TOTAL\"] = total\r\n    data.update(prices)",
   "comment": "",
   "last_line": "26",
   "q2_time": "20240703121338",
   "q2_mode": "u"
  }
 ],
 "forms": [
  {
   "name": "_gorod_gdm_sheet_keys",
   "title": "",
   "seq": "9",
   "menu_path": "",
   "menu_text": "",
   "menu_before": "",
   "menu_icon": "",
   "menu_tiptext": "",
   "menu_separator": "",
   "toolbar": "",
   "ok_button": "",
   "cancel_button": "",
   "view_action": "",
   "form_table": "",
   "form_table_sort": "",
   "comment": "",
   "before_form_build": "",
   "before_grid_build": "",
   "before_grid_show": "",
   "after_grid_show": "",
   "before_form_show": "",
   "after_form_show": "",
   "before_crud_save": "",
   "after_crud_save": "",
   "before_delete": "",
   "after_delete": "",
   "form_valid": "",
   "form_refresh": "",
   "after_form_closed": "",
   "q2_time": "20240703101254",
   "q2_mode": "i"
  },
  {
   "name": "_gorod_gdm_students",
   "title": "\u0423\u0447\u0435\u043d\u0438\u043a\u0438",
   "seq": "6",
   "menu_path": "\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0438",
   "menu_text": "",
   "menu_before": "",
   "menu_icon": "",
   "menu_tiptext": "",
   "menu_separator": "",
   "toolbar": "",
   "ok_button": "",
   "cancel_button": "",
   "view_action": "",
   "form_table": "students",
   "form_table_sort": "id",
   "comment": "",
   "before_form_build": "",
   "before_grid_build": "",
   "before_grid_show": "",
   "after_grid_show": "",
   "before_form_show": "",
   "after_form_show": "",
   "before_crud_save": "",
   "after_crud_save": "",
   "before_delete": "",
   "after_delete": "",
   "form_valid": "",
   "form_refresh": "",
   "after_form_closed": "",
   "q2_time": "20240625122006",
   "q2_mode": "u"
  },
  {
   "name": "_gorod_gdm_subjects",
   "title": "\u041f\u0440\u0435\u0434\u043c\u0435\u0442\u044b",
   "seq": "7",
   "menu_path": "\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0438",
   "menu_text": "",
   "menu_before": "",
   "menu_icon": "",
   "menu_tiptext": "",
   "menu_separator": "",
   "toolbar": "",
   "ok_button": "",
   "cancel_button": "",
   "view_action": "",
   "form_table": "subjects",
   "form_table_sort": "id",
   "comment": "",
   "before_form_build": "",
   "before_grid_build": "",
   "before_grid_show": "",
   "after_grid_show": "",
   "before_form_show": "",
   "after_form_show": "",
   "before_crud_save": "",
   "after_crud_save": "",
   "before_delete": "",
   "after_delete": "",
   "form_valid": "",
   "form_refresh": "",
   "after_form_closed": "",
   "q2_time": "20240627221823",
   "q2_mode": "u"
  },
  {
   "name": "_gorod_gdm_subjects_prices",
   "title": "",
   "seq": "8",
   "menu_path": "",
   "menu_text": "",
   "menu_before": "",
   "menu_icon": "",
   "menu_tiptext": "",
   "menu_separator": "",
   "toolbar": "",
   "ok_button": "",
   "cancel_button": "",
   "view_action": "",
   "form_table": "subjects_prices",
   "form_table_sort": "",
   "comment": "",
   "before_form_build": "",
   "before_grid_build": "",
   "before_grid_show": "",
   "after_grid_show": "",
   "before_form_show": "",
   "after_form_show": "",
   "before_crud_save": "",
   "after_crud_save": "",
   "before_delete": "",
   "after_delete": "",
   "form_valid": "",
   "form_refresh": "",
   "after_form_closed": "",
   "q2_time": "20240627221823",
   "q2_mode": "u"
  }
 ],
 "lines": [
  {
   "id": "171",
   "column": "first_name",
   "label": "\u0418\u043c\u044f",
   "gridlabel": "",
   "mess": "",
   "seq": "2",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "char",
   "datalen": "100",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_students",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625121833",
   "q2_mode": "u"
  },
  {
   "id": "172",
   "column": "last_name",
   "label": "\u0424\u0430\u043c\u0438\u043b\u0438\u044f",
   "gridlabel": "",
   "mess": "",
   "seq": "3",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "char",
   "datalen": "100",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_students",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625121832",
   "q2_mode": "u"
  },
  {
   "id": "173",
   "column": "date_of_birth",
   "label": "\u0414\u0430\u0442\u0430 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f",
   "gridlabel": "",
   "mess": "",
   "seq": "4",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "date",
   "datalen": "0",
   "datadec": "0",
   "migrate": "",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_students",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625121832",
   "q2_mode": "u"
  },
  {
   "id": "177",
   "column": "comments",
   "label": "\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438",
   "gridlabel": "",
   "mess": "",
   "seq": "5",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "text",
   "pic": "",
   "datatype": "text",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_students",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625124249",
   "q2_mode": "u"
  },
  {
   "id": "181",
   "column": "id",
   "label": "\u041a\u043e\u0434",
   "gridlabel": "",
   "mess": "",
   "seq": "1",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "int",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "*",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_students",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625121844",
   "q2_mode": "u"
  },
  {
   "id": "174",
   "column": "id",
   "label": "\u041a\u043e\u0434",
   "gridlabel": "",
   "mess": "",
   "seq": "0",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "int",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "*",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625124227",
   "q2_mode": "u"
  },
  {
   "id": "175",
   "column": "name",
   "label": "\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
   "gridlabel": "",
   "mess": "",
   "seq": "1",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "char",
   "datalen": "100",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625112641",
   "q2_mode": "i"
  },
  {
   "id": "176",
   "column": "comments",
   "label": "\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438",
   "gridlabel": "",
   "mess": "",
   "seq": "3",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "text",
   "pic": "",
   "datatype": "text",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240625125529",
   "q2_mode": "u"
  },
  {
   "id": "186",
   "column": "discount1",
   "label": "\u041f\u0440\u0430\u0432\u043e \u043d\u0430 \u0441\u043a\u0438\u0434\u043a\u0443",
   "gridlabel": "",
   "mess": "",
   "seq": "2",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "check",
   "pic": "",
   "datatype": "char",
   "datalen": "1",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221446",
   "q2_mode": "u"
  },
  {
   "id": "179",
   "column": "parent_id",
   "label": "\u041f\u0440\u0435\u0434\u043c\u0435\u0442",
   "gridlabel": "",
   "mess": "",
   "seq": "7",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "char",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "subjects",
   "to_column": "id",
   "related": "name",
   "to_form": "_gorod_gdm_subjects",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221837",
   "q2_mode": "u"
  },
  {
   "id": "180",
   "column": "code",
   "label": "\u041a\u043e\u0434",
   "gridlabel": "",
   "mess": "",
   "seq": "1",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "char",
   "datalen": "10",
   "datadec": "0",
   "migrate": "*",
   "pk": "*",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221716",
   "q2_mode": "u"
  },
  {
   "id": "182",
   "column": "comments",
   "label": "\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438",
   "gridlabel": "",
   "mess": "",
   "seq": "5",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "text",
   "pic": "",
   "datatype": "text",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221842",
   "q2_mode": "u"
  },
  {
   "id": "183",
   "column": "price",
   "label": "\u0426\u0435\u043d\u0430",
   "gridlabel": "",
   "mess": "",
   "seq": "3",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "num",
   "datalen": "10",
   "datadec": "2",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221841",
   "q2_mode": "u"
  },
  {
   "id": "184",
   "column": "price1",
   "label": "\u0426\u0435\u043d\u0430 \u0441\u043e \u0441\u043a\u0438\u0434\u043a\u043e\u0439",
   "gridlabel": "",
   "mess": "",
   "seq": "4",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "num",
   "datalen": "10",
   "datadec": "2",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221841",
   "q2_mode": "u"
  },
  {
   "id": "185",
   "column": "lasting",
   "label": "\u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c (\u043c\u0438\u043d)",
   "gridlabel": "",
   "mess": "",
   "seq": "6",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "int",
   "datalen": "0",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221842",
   "q2_mode": "u"
  },
  {
   "id": "247",
   "column": "name",
   "label": "\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
   "gridlabel": "",
   "mess": "",
   "seq": "2",
   "nogrid": "",
   "noform": "",
   "check": "",
   "disabled": "",
   "readonly": "",
   "stretch": "0",
   "alignment": "0",
   "tag": "",
   "control": "line",
   "pic": "",
   "datatype": "char",
   "datalen": "100",
   "datadec": "0",
   "migrate": "*",
   "pk": "",
   "ai": "",
   "to_table": "",
   "to_column": "",
   "related": "",
   "to_form": "",
   "name": "_gorod_gdm_subjects_prices",
   "comment": "",
   "code_when": "",
   "code_show": "",
   "code_valid": "",
   "style": "",
   "q2_time": "20240627221841",
   "q2_mode": "u"
  }
 ],
 "queries": [],
 "actions": [
  {
   "id": "45",
   "action_text": "\u041f\u0440\u0438\u043d\u044f\u0442\u044c",
   "seq": "0",
   "action_mode": "2",
   "action_mess": "",
   "action_icon": "",
   "action_key": "",
   "tag": "",
   "eof_disabled": "",
   "child_form": "",
   "child_where": "",
   "child_noshow": "",
   "child_copy_mode": "1",
   "name": "_gorod_gdm_sheet_keys",
   "action_worker": "if self.heap.gd is None:\r\n    q2mess(\"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c\u0438 \u0413\u0443\u0433\u043b \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e!<br>\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438\")\r\n    return\r\n\r\nsheet = mem.heap.load_docs_row()\r\nq2mess(sheet)",
   "comment": "",
   "q2_time": "20240703101543",
   "q2_mode": "u"
  },
  {
   "id": "31",
   "action_text": "",
   "seq": "0",
   "action_mode": "1",
   "action_mess": "",
   "action_icon": "",
   "action_key": "",
   "tag": "",
   "eof_disabled": "",
   "child_form": "",
   "child_where": "",
   "child_noshow": "",
   "child_copy_mode": "0",
   "name": "_gorod_gdm_students",
   "action_worker": "",
   "comment": "",
   "q2_time": "20240625112226",
   "q2_mode": "i"
  },
  {
   "id": "32",
   "action_text": "",
   "seq": "0",
   "action_mode": "1",
   "action_mess": "",
   "action_icon": "",
   "action_key": "",
   "tag": "",
   "eof_disabled": "",
   "child_form": "",
   "child_where": "",
   "child_noshow": "",
   "child_copy_mode": "0",
   "name": "_gorod_gdm_subjects",
   "action_worker": "",
   "comment": "",
   "q2_time": "20240625112511",
   "q2_mode": "i"
  },
  {
   "id": "34",
   "action_text": "\u0426\u0435\u043d\u044b",
   "seq": "1",
   "action_mode": "2",
   "action_mess": "",
   "action_icon": "",
   "action_key": "F2",
   "tag": "",
   "eof_disabled": "",
   "child_form": "_gorod_gdm_subjects_prices",
   "child_where": "parent_id={id}",
   "child_noshow": "",
   "child_copy_mode": "1",
   "name": "_gorod_gdm_subjects",
   "action_worker": "",
   "comment": "",
   "q2_time": "20240627222141",
   "q2_mode": "u"
  },
  {
   "id": "33",
   "action_text": "",
   "seq": "0",
   "action_mode": "1",
   "action_mess": "",
   "action_icon": "",
   "action_key": "",
   "tag": "",
   "eof_disabled": "",
   "child_form": "",
   "child_where": "",
   "child_noshow": "",
   "child_copy_mode": "0",
   "name": "_gorod_gdm_subjects_prices",
   "action_worker": "",
   "comment": "",
   "q2_time": "20240625112805",
   "q2_mode": "i"
  }
 ],
 "reports": [],
 "packages": [
  {
   "package_name": "q2googledrive",
   "package_pipname": "",
   "package_version": "",
   "comment": "",
   "q2_time": "20240612154828",
   "q2_mode": "i"
  }
 ]
}